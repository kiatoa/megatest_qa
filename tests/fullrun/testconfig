[setup]
submegatest #{getenv MTTESTDIR}/fullrun

[ezsteps]
cleantop $MTRUNNER $MTTESTDIR/fullrun $MTPATH megatest -remove-runs -target ubuntu/nfs/none -runname release_toplevel -testpatt %
runall   $MTRUNNER $MTTESTDIR/fullrun $MTPATH megatest -run -testpatt %            -target ubuntu/nfs/none -runname release_toplevel -run-wait
runtop   $MTRUNNER $MTTESTDIR/fullrun $MTPATH megatest -run -testpatt all_toplevel -target ubuntu/nfs/none -runname release_toplevel -rerun FAIL -preclean -run-wait
results  $MTRUNNER $MTTESTDIR/fullrun $MTPATH megatest -list-runs release_toplevel -target ubuntu/nfs/none -runname release_toplevel 

[logpro]
cleantop ;;
  (expect:warning in "LogFileBody" = 0 "Warn if can't remove files" #/ERROR: There was a problem removing/)
  (expect:error in "LogFileBody" = 0 "No errors allowed" #/error/i)
runall ;;
  (expect:ignore    in "LogFileBody" >= 0 "Ignore issues due to NFS" #/ERROR: There was a problem removing/)
  (expect:required  in "LogFileBody" > 0 "need to see at least one unrecognised waiton" #/ERROR: test special has unrecognised waiton testname/)
  (expect:required  in "LogFileBody" > 0 "need to see at least one dynamic_waiton"      #/ERROR: test dynamic_waiton has listed itself as a waiton/)
  (expect:required  in "LogFileBody" > 0 "expecting to see some Failed launch"          #/ERROR: Failed to launch test blocktestxz/)
  (expect:error     in "LogFileBody" = 0 "No errors allowed" #/error/i)

[requirements]
waiton toprun
priority 10

# This is a "toplevel" test, it does not require waitons to be non-FAIL to run
mode toplevel
